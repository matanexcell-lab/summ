<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>סיכום שיחה</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box; font-family: system-ui, sans-serif; }
    body { background:#f3f4f6; margin:0; padding:20px; }
    .card {
      background:#fff; border-radius:18px; padding:20px;
      max-width:520px; margin:auto; box-shadow:0 8px 30px rgba(0,0,0,.1)
    }
    h2 { text-align:center; margin-top:0 }
    select,input,textarea {
      width:100%; padding:10px; margin-top:6px;
      border-radius:10px; border:1px solid #ccc;
      font-size:15px;
    }
    textarea { min-height:70px }
    .btn {
      padding:12px; border:none; border-radius:999px;
      font-size:16px; cursor:pointer; margin-top:12px;
    }
    .btn-primary { background:#2563eb; color:#fff }
    .btn-secondary { background:#e5e7eb }
    .hidden { display:none }
    pre {
      background:#111827; color:#f9fafb;
      padding:14px; border-radius:14px;
      white-space:pre-wrap; margin-top:14px;
    }
    .label { margin-top:12px; font-weight:600 }
  </style>
</head>

<body>

<div class="card">
  <h2>סיכום שיחה</h2>

  <div id="form"></div>

  <button class="btn btn-primary" onclick="next()">המשך</button>
  <button class="btn btn-secondary" onclick="back()">חזרה</button>

  <pre id="summary" class="hidden"></pre>
</div>

<!-- ===== ניהול מסלולי השקעה (ניתן לעריכה בלי קוד) ===== -->
<textarea id="tracksConfig" class="hidden">
כללי
לבני 50 ומטה
לבני 50-60
לבני 60 ומעלה
מניות
Snp500
משולב סחיר
עוקב מדדים גמיש
מניות סחיר
עוקב מדדי מניות
השלוש הקדוש
חצי חצי אנליסט
</textarea>

<script>
/* =====================
   נתונים
===================== */

const PRODUCTS = ["קרן פנסיה","קרן השתלמות","קופת גמל","קופת גמל להשקעה"];
const EMPLOYMENT = ["שכירה","עצמאית","ללא"];
const DEPOSIT_TYPES = ["ללא הפקדה","הוראת קבע","חד פעמי","גם וגם"];

const SPECIAL_TRACK_OUTPUT = {
  "השלוש הקדוש": "33% משולב סחיר, 33% מדדי מניות, 34% Snp500",
  "חצי חצי אנליסט": "50% עוקב מדדים גמיש, 50% Snp500"
};

/* =====================
   State
===================== */

let step = 0;
let history = [];
let data = {};

/* =====================
   Helpers
===================== */

function getTracks() {
  const el = document.getElementById("tracksConfig");
  return el.value.split("\n").map(t=>t.trim()).filter(Boolean);
}

function trackLabel(t){
  return SPECIAL_TRACK_OUTPUT[t] || t;
}

/* =====================
   Render
===================== */

function render(){
  const f = document.getElementById("form");
  const s = document.getElementById("summary");
  s.classList.add("hidden");

  if(step===0){
    f.innerHTML=`
      <div class="label">בחר סוג מוצר</div>
      <select id="product">
        <option value="">בחר...</option>
        ${PRODUCTS.map(p=>`<option ${data.product===p?"selected":""}>${p}</option>`).join("")}
      </select>
    `;
  }

  if(step===1){
    f.innerHTML=`
      <div class="label">מצב תעסוקתי</div>
      <select id="employment">
        <option value="">בחר...</option>
        ${EMPLOYMENT.map(e=>`<option ${data.employment===e?"selected":""}>${e}</option>`).join("")}
      </select>

      <input id="employer"
        class="${data.employment==="שכירה"?"":"hidden"}"
        placeholder="שם מעסיק"
        value="${data.employer||""}">
    `;
  }

  if(step===2){
    f.innerHTML=`
      <div class="label">אופי ההפקדה</div>
      <select id="depositType">
        ${DEPOSIT_TYPES.map(d=>`<option ${data.depositType===d?"selected":""}>${d}</option>`).join("")}
      </select>

      <input id="monthly" class="${["הוראת קבע","גם וגם"].includes(data.depositType)?"":"hidden"}"
        type="number" placeholder="סכום חודשי" value="${data.monthly||""}">
      <input id="oneTime" class="${["חד פעמי","גם וגם"].includes(data.depositType)?"":"hidden"}"
        type="number" placeholder="סכום חד פעמי" value="${data.oneTime||""}">
    `;
  }

  if(step===3){
    f.innerHTML=`
      <div class="label">מסלול השקעה</div>
      <select id="track">
        ${getTracks().map(t=>`<option ${data.track===t?"selected":""}>${t}</option>`).join("")}
      </select>
    `;
  }

  if(step===4){
    f.innerHTML="";
    s.textContent =
`בהמשך לשיחתנו
סוכם על הדברים הבאים:

פתיחת ${data.product}
${data.employment==="שכירה" && data.employer ? "שכירה תחת המעסיק "+data.employer : ""}
${data.employment==="עצמאית" ? "עצמאית" : ""}
במסלול השקעה ${trackLabel(data.track)}
${formatDeposit()}`;
    s.classList.remove("hidden");
  }

  wire();
}

/* =====================
   Logic
===================== */

function next(){
  if(step===0){
    const v=document.getElementById("product").value;
    if(!v) return alert("בחר מוצר");
    data.product=v;
    history.push(step);
    step=1;
    return render();
  }

  if(step===1){
    data.employment=document.getElementById("employment").value;
    data.employer=document.getElementById("employer")?.value||"";
    if(!data.employment) return alert("בחר מצב תעסוקתי");

    history.push(step);

    // עצמאי / גמל / השתלמות / גמל להשקעה → תמיד הפקדות
    if(
      data.employment==="עצמאית" ||
      ["קרן השתלמות","קופת גמל","קופת גמל להשקעה"].includes(data.product)
    ){
      step=2;
    } else {
      step=3;
    }
    return render();
  }

  if(step===2){
    data.depositType=document.getElementById("depositType").value;
    data.monthly=document.getElementById("monthly")?.value||"";
    data.oneTime=document.getElementById("oneTime")?.value||"";
    history.push(step);
    step=3;
    return render();
  }

  if(step===3){
    data.track=document.getElementById("track").value;
    history.push(step);
    step=4;
    return render();
  }
}

function back(){
  if(!history.length) return;
  step=history.pop();
  render();
}

function formatDeposit(){
  if(data.depositType==="הוראת קבע") return `עם הוראת קבע של ${data.monthly} ₪ בחודש.`;
  if(data.depositType==="חד פעמי") return `עם הפקדה חד פעמית של ${data.oneTime} ₪.`;
  if(data.depositType==="גם וגם") return `עם הוראת קבע של ${data.monthly} ₪ בחודש והפקדה חד פעמית של ${data.oneTime} ₪.`;
  return ".";
}

function wire(){
  const emp=document.getElementById("employment");
  const employer=document.getElementById("employer");
  if(emp && employer){
    emp.onchange=()=>employer.classList.toggle("hidden",emp.value!=="שכירה");
  }

  const d=document.getElementById("depositType");
  const m=document.getElementById("monthly");
  const o=document.getElementById("oneTime");
  if(d){
    d.onchange=()=>{
      m?.classList.toggle("hidden",!["הוראת קבע","גם וגם"].includes(d.value));
      o?.classList.toggle("hidden",!["חד פעמי","גם וגם"].includes(d.value));
    }
  }
}

/* start */
render();
</script>

</body>
</html>